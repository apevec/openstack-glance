From 0795367c41dc4096ee45af6b4ebc6e79d5f2b41e Mon Sep 17 00:00:00 2001
From: Rick Harris <rconradharris@gmail.com>
Date: Fri, 11 Nov 2011 18:39:31 +0000
Subject: [PATCH] Making prefetcher call create_stores.

Fixes bug 888383

(cherry picked from commit f394327f3869b8b820f1fdd345c7e6073dd82820)

Change-Id: Ia3adc6a30f16f889cd344f8cb3fca4a071871fe4
---
 glance/image_cache/prefetcher.py |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/glance/image_cache/prefetcher.py b/glance/image_cache/prefetcher.py
index dba7f9c..4895f32 100644
--- a/glance/image_cache/prefetcher.py
+++ b/glance/image_cache/prefetcher.py
@@ -27,6 +27,12 @@ from glance.common import config
 from glance.common import context
 from glance.image_cache import ImageCache
 from glance import registry
+import glance.store
+import glance.store.filesystem
+import glance.store.http
+import glance.store.rbd
+import glance.store.s3
+import glance.store.swift
 from glance.store import get_from_backend
 
 
@@ -36,6 +42,7 @@ logger = logging.getLogger('glance.image_cache.prefetcher')
 class Prefetcher(object):
     def __init__(self, options):
         self.options = options
+        glance.store.create_stores(options)
         self.cache = ImageCache(options)
 
     def fetch_image_into_cache(self, image_id):
-- 
1.7.6.5

